<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Saanp Seedhi â€“ Shubham vs Shivani</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow-x:hidden}
body{min-height:100vh;font-family:'Nunito',sans-serif;transition:background .5s,color .3s}
body.day{background:radial-gradient(ellipse at 20% 10%,#fce4ff,#fff9e8 50%,#e8f5e9);color:#2d1b4e}
body.night{background:radial-gradient(ellipse at 20% 10%,#0a1628,#080d1a 50%,#0a1a10);color:#f5e6c8}

@keyframes diceSpin{0%,100%{transform:rotate(0)scale(1)}25%{transform:rotate(-25deg)scale(1.1)}75%{transform:rotate(25deg)scale(1.1)}}
@keyframes tokenBounce{0%{transform:scale(1)translateY(0)}40%{transform:scale(1.55)translateY(-14px)}100%{transform:scale(1)translateY(0)}}
@keyframes floatAnim{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 0 0 rgba(255,215,0,.4)}50%{box-shadow:0 0 0 8px rgba(255,215,0,0)}}
@keyframes freezeGlow{0%,100%{box-shadow:0 0 0 0 rgba(56,189,248,.5)}50%{box-shadow:0 0 18px 6px rgba(56,189,248,.25)}}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes winPop{0%{opacity:0;transform:scale(.4)rotate(-6deg)}60%{transform:scale(1.07)rotate(2deg)}100%{opacity:1;transform:scale(1)rotate(0)}}
@keyframes shimmerBg{0%{background-position:200% center}100%{background-position:0% center}}
@keyframes confettiFall{0%{transform:translateY(-10px)rotate(0);opacity:1}100%{transform:translateY(100vh)rotate(720deg);opacity:0}}
@keyframes twinkle{0%,100%{opacity:.2}50%{opacity:1}}
@keyframes bonusToast{0%{opacity:0;transform:translateX(-50%) translateY(-10px)}15%,85%{opacity:1;transform:translateX(-50%) translateY(0)}100%{opacity:0}}
@keyframes aiDots{0%,100%{opacity:.3}50%{opacity:1}}

.dice-spin{animation:diceSpin .1s infinite}
.token-bounce{animation:tokenBounce .55s cubic-bezier(.34,1.56,.64,1)}
.win-pop{animation:winPop .65s cubic-bezier(.34,1.56,.64,1) forwards}
.shimmer-btn{background:linear-gradient(90deg,#7b2d8b,#c77dff,#e07a5f,#7b2d8b);background-size:300%;animation:shimmerBg 2.5s linear infinite}
.confetti-piece{position:fixed;pointer-events:none;z-index:1000;animation:confettiFall var(--d,3s) ease-in var(--delay,0s) forwards}
.ai-dot{display:inline-block;animation:aiDots .8s infinite;animation-delay:var(--dd,0s)}

/* â”€â”€ Glass â”€â”€ */
body.day  .glass{background:rgba(255,255,255,.78);border:1px solid rgba(123,45,139,.15);backdrop-filter:blur(14px)}
body.night .glass{background:rgba(255,255,255,.05);border:1px solid rgba(255,215,0,.18);backdrop-filter:blur(14px)}

/* â”€â”€ Token â”€â”€ */
.token{position:absolute;border-radius:50%;z-index:20;transition:left .7s cubic-bezier(.34,1.56,.64,1),top .7s cubic-bezier(.34,1.56,.64,1);pointer-events:none}

/* â”€â”€ Scrollbar â”€â”€ */
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-thumb{background:rgba(123,45,139,.4);border-radius:3px}
body.night ::-webkit-scrollbar-thumb{background:rgba(255,215,0,.25)}

/* â•â•â•â• HEADER â•â•â•â•
   Fixed two-zone layout: left zone + right zone
   Title sits between them, scales gracefully.            */
.site-header{
  display:flex;
  align-items:center;
  padding:8px 12px;
  gap:6px;
  position:sticky;top:0;z-index:200;
}
.hdr-left{display:flex;align-items:center;gap:6px;flex-shrink:0}
.hdr-title{
  flex:1;
  text-align:center;
  min-width:0;
  overflow:hidden;
}
.hdr-title h1{
  font-family:'Cinzel',serif;
  font-size:clamp(11px,3.2vw,26px);
  font-weight:900;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  letter-spacing:clamp(.5px,.3vw,2px);
  line-height:1.1;
}
.hdr-title .sub{
  font-family:'Cinzel',serif;
  font-size:clamp(7px,1.1vw,9px);
  letter-spacing:clamp(1px,.4vw,3px);
  margin-top:1px;
  opacity:.7;
}
.hdr-right{display:flex;align-items:center;gap:6px;flex-shrink:0}

/* â”€â”€ iOS pill toggle â”€â”€
   Labels hidden on small screens to save space            */
.ios-wrap{
  display:flex;align-items:center;
  background:rgba(0,0,0,.18);border-radius:50px;
  padding:3px;border:1px solid rgba(255,255,255,.12);
  flex-shrink:0;
}
body.day .ios-wrap{background:rgba(0,0,0,.08);border-color:rgba(0,0,0,.12)}
.ios-seg{
  display:flex;align-items:center;justify-content:center;gap:4px;
  padding:5px 10px;border-radius:50px;border:none;
  background:transparent;cursor:pointer;
  font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;
  transition:all .25s cubic-bezier(.34,1.56,.64,1);
  color:inherit;white-space:nowrap;
}
.ios-seg.active{background:rgba(255,255,255,.92);color:#1a1a2e;box-shadow:0 2px 10px rgba(0,0,0,.25)}
body.day .ios-seg.active{background:white}
/* Hide text labels on very narrow screens */
@media(max-width:420px){.ios-label{display:none}}

/* â”€â”€ Fullscreen button â”€â”€ */
.fs-btn{
  width:32px;height:32px;border-radius:50%;border:none;
  display:flex;align-items:center;justify-content:center;
  font-size:15px;cursor:pointer;flex-shrink:0;
  transition:transform .2s;
}
.fs-btn:hover{transform:scale(1.15)}

/* â”€â”€ Tiny header buttons â”€â”€ */
.hdr-btn{
  border-radius:50px;border:none;padding:6px 10px;
  font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;
  cursor:pointer;white-space:nowrap;flex-shrink:0;
  transition:all .2s;
}

/* â”€â”€ Mode / player selection cards â”€â”€ */
.mode-card{border-radius:20px;padding:24px 16px;text-align:center;cursor:pointer;transition:all .25s;border:2px solid transparent}
.mode-card:hover{transform:translateY(-4px)}
.player-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
</style>
</head>
<body class="night">
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useMemo}=React;

/* â•â•â• CONSTANTS â•â•â• */
const SNAKES={99:21,95:75,87:24,62:19,54:34,64:60,17:7,47:26,56:8,93:68};
const LADDERS={4:14,9:31,20:38,28:84,40:59,51:67,63:81,71:91};
const BONUS_TYPES=[
  {id:'extra', icon:'â­',label:'Extra Dice Roll',desc:'Roll again immediately!',           color:'#f59e0b'},
  {id:'shield',icon:'ğŸ›¡ï¸',label:'Snake Shield',  desc:'Blocks the next snake bite.',      color:'#10b981'},
  {id:'jump',  icon:'ğŸš€',label:'Jump +5 Steps', desc:'Teleport 5 cells forward.',        color:'#ef4444'},
  {id:'freeze',icon:'â„ï¸',label:'Freeze Opponent',desc:"Opponent skips their next turn.", color:'#38bdf8'},
];
const COLORS=[
  {name:'Crimson',v:'#e63946',l:'#ff8fa3'},
  {name:'Ocean',  v:'#0077b6',l:'#48cae4'},
  {name:'Emerald',v:'#2d6a4f',l:'#52b788'},
  {name:'Violet', v:'#7b2d8b',l:'#c77dff'},
  {name:'Amber',  v:'#e07a5f',l:'#f4a261'},
  {name:'Rose',   v:'#9d0208',l:'#e85d04'},
];
const DICE_EMOJI=['','âš€','âš','âš‚','âšƒ','âš„','âš…'];
let _uid=0;

/* â•â•â• COORD HELPERS â•â•â• */
function cellToPos(cell){
  if(cell<=0)return{row:9,col:0};
  const rfb=Math.floor((cell-1)/10),pir=(cell-1)%10;
  return{row:9-rfb,col:rfb%2===0?pir:9-pir};
}
function posToCell(r,c){const rfb=9-r;return rfb*10+(rfb%2===0?c:9-c)+1;}
function cellCenter(cell,C){const{row,col}=cellToPos(cell);return{x:col*C+C/2,y:row*C+C/2};}

/* â•â•â• AVATARS â•â•â• */
function shubhamSVG(color,size,uid){return `<svg width="${size}" height="${size}" viewBox="0 0 100 100" style="border-radius:50%;border:3px solid ${color};box-shadow:0 0 16px ${color}99;display:block">
<defs><radialGradient id="rg${uid}" cx="50%" cy="35%" r="60%"><stop offset="0%" stop-color="#fde8c8"/><stop offset="100%" stop-color="#c8783a"/></radialGradient></defs>
<circle cx="50" cy="50" r="50" fill="${color}25"/>
<ellipse cx="50" cy="88" rx="40" ry="26" fill="${color}"/>
<text x="50" y="96" text-anchor="middle" font-size="9" font-weight="900" font-family="Nunito,sans-serif" fill="rgba(255,255,255,0.9)">SHUBHAM</text>
<rect x="42" y="57" width="16" height="14" rx="5" fill="url(#rg${uid})"/>
<circle cx="50" cy="36" r="23" fill="url(#rg${uid})"/>
<path d="M27 34 Q29 12 50 14 Q71 12 73 34 Q76 20 69 13 Q55 3 45 7 Q25 11 27 34Z" fill="#2a1505"/>
<ellipse cx="27" cy="37" rx="4" ry="6.5" fill="#c8783a"/><ellipse cx="73" cy="37" rx="4" ry="6.5" fill="#c8783a"/>
<path d="M36 27 Q43 23 49 27" stroke="#2a1505" stroke-width="2.8" fill="none" stroke-linecap="round"/>
<path d="M51 27 Q57 23 64 27" stroke="#2a1505" stroke-width="2.8" fill="none" stroke-linecap="round"/>
<ellipse cx="42" cy="33" rx="5.5" ry="6" fill="white"/><ellipse cx="58" cy="33" rx="5.5" ry="6" fill="white"/>
<circle cx="43" cy="33" r="3.5" fill="#1a0800"/><circle cx="59" cy="33" r="3.5" fill="#1a0800"/>
<circle cx="44" cy="31.5" r="1.3" fill="white"/><circle cx="60" cy="31.5" r="1.3" fill="white"/>
<ellipse cx="50" cy="43" rx="3" ry="2.2" fill="#b06838"/>
<path d="M40 50 Q50 57 60 50" stroke="#a05030" stroke-width="2.5" fill="none" stroke-linecap="round"/>
</svg>`;}

function shivaniSVG(color,size,uid){return `<svg width="${size}" height="${size}" viewBox="0 0 100 100" style="border-radius:50%;border:3px solid ${color};box-shadow:0 0 16px ${color}99;display:block">
<defs><radialGradient id="rg${uid}" cx="50%" cy="35%" r="60%"><stop offset="0%" stop-color="#fde8c8"/><stop offset="100%" stop-color="#c8783a"/></radialGradient></defs>
<circle cx="50" cy="50" r="50" fill="${color}25"/>
<ellipse cx="50" cy="88" rx="42" ry="28" fill="${color}"/>
<text x="50" y="96" text-anchor="middle" font-size="9" font-weight="900" font-family="Nunito,sans-serif" fill="rgba(255,255,255,0.9)">SHIVANI</text>
<rect x="42" y="57" width="16" height="14" rx="5" fill="url(#rg${uid})"/>
<circle cx="50" cy="36" r="23" fill="url(#rg${uid})"/>
<path d="M27 34 Q29 10 50 12 Q71 10 73 34 Q72 18 67 12 Q54 2 46 6 Q24 10 27 34Z" fill="#1a0800"/>
<path d="M27 34 Q20 52 23 68 Q28 54 32 44" fill="#1a0800"/>
<path d="M73 34 Q80 52 77 68 Q72 54 68 44" fill="#1a0800"/>
<ellipse cx="27" cy="37" rx="4" ry="6.5" fill="#c8783a"/><ellipse cx="73" cy="37" rx="4" ry="6.5" fill="#c8783a"/>
<circle cx="27" cy="45" r="3.5" fill="gold"/><circle cx="73" cy="45" r="3.5" fill="gold"/>
<circle cx="50" cy="21" r="4" fill="#e63946"/><circle cx="50" cy="21" r="2" fill="#ff8fa3"/>
<path d="M35 27 Q43 22 49 27" stroke="#1a0800" stroke-width="2.8" fill="none" stroke-linecap="round"/>
<path d="M51 27 Q57 22 65 27" stroke="#1a0800" stroke-width="2.8" fill="none" stroke-linecap="round"/>
<ellipse cx="42" cy="33" rx="5.5" ry="6" fill="white"/><ellipse cx="58" cy="33" rx="5.5" ry="6" fill="white"/>
<circle cx="42" cy="33" r="3.8" fill="#1a0800"/><circle cx="58" cy="33" r="3.8" fill="#1a0800"/>
<circle cx="43" cy="31.5" r="1.3" fill="white"/><circle cx="59" cy="31.5" r="1.3" fill="white"/>
<path d="M37 27 L35 24 M41 26 L40 23 M46 26 L46 23" stroke="#1a0800" stroke-width="1.5" fill="none"/>
<path d="M54 26 L54 23 M59 26 L60 23 M63 27 L65 24" stroke="#1a0800" stroke-width="1.5" fill="none"/>
<ellipse cx="50" cy="43" rx="3" ry="2.2" fill="#b06838"/>
<path d="M41 50 Q50 56 59 50" stroke="#e63946" stroke-width="2.8" fill="none" stroke-linecap="round"/>
</svg>`;}

function Avatar({isSh,color,size,uid}){
  const html=isSh?shubhamSVG(color,size,uid):shivaniSVG(color,size,uid);
  return <span dangerouslySetInnerHTML={{__html:html}} style={{display:'inline-block',flexShrink:0}}/>;
}

/* â•â•â• BOARD SVG OVERLAY â•â•â• */
const BoardSVGOverlay=React.memo(function({C}){
  const B=C*10;
  return(
    <svg style={{position:'absolute',top:0,left:0,pointerEvents:'none',zIndex:5,overflow:'visible'}} width={B} height={B} viewBox={`0 0 ${B} ${B}`}>
      <defs>
        {Object.entries(SNAKES).map(([f],i)=>{
          const fc=cellCenter(+f,C),tc=cellCenter(SNAKES[f],C);
          return <linearGradient key={i} id={`snk${i}`} gradientUnits="userSpaceOnUse" x1={fc.x} y1={fc.y} x2={tc.x} y2={tc.y}>
            <stop offset="0%" stopColor="#dc2626"/><stop offset="45%" stopColor="#ef4444"/><stop offset="100%" stopColor="#15803d"/>
          </linearGradient>;
        })}
      </defs>
      {/* Ladders */}
      {Object.entries(LADDERS).map(([from,to],i)=>{
        const f=cellCenter(+from,C),t=cellCenter(+to,C);
        const dx=t.y-f.y,dy=-(t.x-f.x),len=Math.sqrt(dx*dx+dy*dy)||1;
        const nx=dx/len*5.5,ny=dy/len*5.5;
        const rungs=[];
        for(let k=0.1;k<0.92;k+=0.16)rungs.push({x1:f.x-nx+(t.x-nx-(f.x-nx))*k,y1:f.y-ny+(t.y-ny-(f.y-ny))*k,x2:f.x+nx+(t.x+nx-(f.x+nx))*k,y2:f.y+ny+(t.y+ny-(f.y+ny))*k});
        return <g key={i}>
          <line x1={f.x-nx} y1={f.y-ny} x2={t.x-nx} y2={t.y-ny} stroke="#000" strokeWidth={10} opacity={.12} strokeLinecap="round"/>
          <line x1={f.x+nx} y1={f.y+ny} x2={t.x+nx} y2={t.y+ny} stroke="#000" strokeWidth={10} opacity={.12} strokeLinecap="round"/>
          <line x1={f.x-nx} y1={f.y-ny} x2={t.x-nx} y2={t.y-ny} stroke="#92400e" strokeWidth={5} strokeLinecap="round"/>
          <line x1={f.x+nx} y1={f.y+ny} x2={t.x+nx} y2={t.y+ny} stroke="#92400e" strokeWidth={5} strokeLinecap="round"/>
          <line x1={f.x-nx} y1={f.y-ny} x2={t.x-nx} y2={t.y-ny} stroke="#fbbf24" strokeWidth={1.5} strokeLinecap="round" opacity={.5}/>
          <line x1={f.x+nx} y1={f.y+ny} x2={t.x+nx} y2={t.y+ny} stroke="#fbbf24" strokeWidth={1.5} strokeLinecap="round" opacity={.5}/>
          {rungs.map((r,j)=><line key={j} x1={r.x1} y1={r.y1} x2={r.x2} y2={r.y2} stroke="#fbbf24" strokeWidth={3.5} strokeLinecap="round"/>)}
          <circle cx={f.x} cy={f.y} r={5} fill="#fbbf24" opacity={.6}/>
        </g>;
      })}
      {/* Snakes */}
      {Object.entries(SNAKES).map(([from,to],i)=>{
        const f=cellCenter(+from,C),t=cellCenter(+to,C);
        const mx=(f.x+t.x)/2,my=(f.y+t.y)/2,dist=Math.sqrt((f.x-t.x)**2+(f.y-t.y)**2);
        const side=i%2===0?1:-1;
        const path=`M${f.x},${f.y} C${mx+side*dist*.3},${my-side*dist*.08} ${mx-side*dist*.16},${my+side*dist*.26} ${t.x},${t.y}`;
        return <g key={i}>
          <path d={path} stroke="#000" strokeWidth={9} fill="none" opacity={.18} strokeLinecap="round"/>
          <path d={path} stroke={`url(#snk${i})`} strokeWidth={7} fill="none" strokeLinecap="round"/>
          <path d={path} stroke="rgba(255,255,255,.22)" strokeWidth={2.5} fill="none" strokeDasharray="5,9" strokeLinecap="round"/>
          <circle cx={f.x} cy={f.y} r={9} fill="#b91c1c"/><circle cx={f.x} cy={f.y} r={7} fill="#ef4444"/>
          <circle cx={f.x-3} cy={f.y-3} r={2.5} fill="white"/><circle cx={f.x+3} cy={f.y-3} r={2.5} fill="white"/>
          <circle cx={f.x-3} cy={f.y-3} r={1.2} fill="#1a0800"/><circle cx={f.x+3} cy={f.y-3} r={1.2} fill="#1a0800"/>
          <line x1={f.x} y1={f.y+7} x2={f.x-3.5} y2={f.y+12} stroke="#e63946" strokeWidth={1.5}/>
          <line x1={f.x} y1={f.y+7} x2={f.x+3.5} y2={f.y+12} stroke="#e63946" strokeWidth={1.5}/>
          <circle cx={t.x} cy={t.y} r={4} fill="#15803d" opacity={.8}/>
        </g>;
      })}
    </svg>
  );
});

/* â•â•â• BOARD GRID â•â•â• */
const BoardGrid=React.memo(function({bonusMap,night,C}){
  const cells=[];
  for(let r=0;r<10;r++)for(let c=0;c<10;c++){
    const num=posToCell(r,c),isLight=(r+c)%2===0,bonus=bonusMap[num];
    let emoji='';
    if(num===100)emoji='ğŸ†';
    else if(SNAKES[num])emoji='ğŸ';
    else if(LADDERS[num])emoji='ğŸªœ';
    cells.push(
      <div key={num} style={{width:C,height:C,background:isLight?(night?'#152b0a':'#fef3c7'):(night?'#0e1e07':'#d1e7a0'),border:`1px solid ${night?'rgba(255,255,255,.06)':'rgba(0,0,0,.1)'}`,position:'relative',display:'flex',alignItems:'center',justifyContent:'center',fontSize:Math.max(12,C*.3)}}>
        <span style={{position:'absolute',top:2,left:3,fontSize:Math.max(7,C*.14),fontWeight:800,opacity:.5,color:night?'#6abf47':'#78350f'}}>{num}</span>
        <span>{emoji}</span>
        {bonus&&LADDERS[num]&&<span style={{position:'absolute',bottom:1,right:2,fontSize:Math.max(9,C*.18),filter:'drop-shadow(0 0 5px gold)',animation:'twinkle 1.5s infinite'}}>{bonus.icon}</span>}
      </div>
    );
  }
  return <div style={{display:'grid',gridTemplateColumns:`repeat(10,${C}px)`,gridTemplateRows:`repeat(10,${C}px)`,border:`4px solid ${night?'#ffd700':'#7b2d8b'}`,borderRadius:12,overflow:'hidden',position:'relative'}}>{cells}</div>;
});

/* â•â•â• TOKEN â•â•â• */
function Token({player,position,color,sameCell,moving,C}){
  if(position<=0)return null;
  const{row,col}=cellToPos(position);
  const SZ=Math.max(24,C*.72);
  const off=sameCell?(player==='S'?-SZ*.35:SZ*.35):0;
  const html=player==='S'?shubhamSVG(color,SZ,'tokS'):shivaniSVG(color,SZ,'tokV');
  return <div className={`token${moving?' token-bounce':''}`} style={{left:col*C+C/2-SZ/2+off,top:row*C+C/2-SZ/2,width:SZ,height:SZ}}>
    <span dangerouslySetInnerHTML={{__html:html}}/>
  </div>;
}

/* â•â•â• CONFETTI â•â•â• */
function Confetti(){
  const p=useMemo(()=>Array.from({length:50},(_,i)=>({left:Math.random()*100+'%',delay:Math.random()*2,dur:1.8+Math.random()*2.5,color:['#ffd700','#e63946','#0077b6','#c77dff','#52b788','#f4a261','#ff85a1'][i%7],size:5+Math.random()*9,shape:i%3===0?'50%':'3px'})),[]);
  return <div style={{position:'fixed',inset:0,pointerEvents:'none',zIndex:999}}>{p.map((x,i)=><div key={i} className="confetti-piece" style={{left:x.left,top:'-15px',width:x.size,height:x.size,background:x.color,borderRadius:x.shape,'--d':x.dur+'s','--delay':x.delay+'s'}}/>)}</div>;
}

/* â•â•â• INFO MODAL â•â•â• */
function InfoModal({onClose,night}){
  const a=night?'#ffd700':'#7b2d8b',sub=night?'rgba(245,230,200,.6)':'#6b5a8e';
  return <div onClick={onClose} style={{position:'fixed',inset:0,background:'rgba(0,0,0,.72)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:600,padding:14}}>
    <div onClick={e=>e.stopPropagation()} style={{background:night?'rgba(8,13,26,.97)':'rgba(255,255,255,.97)',border:`1px solid ${night?'rgba(255,215,0,.25)':'rgba(123,45,139,.2)'}`,borderRadius:24,padding:22,maxWidth:370,width:'100%',boxShadow:'0 30px 80px rgba(0,0,0,.6)',maxHeight:'88vh',overflowY:'auto'}}>
      <h2 style={{fontFamily:'Cinzel,serif',color:a,marginBottom:16,fontSize:18,textAlign:'center',letterSpacing:2}}>ğŸ“œ HOW TO PLAY</h2>
      {[['ğŸ²','Roll dice to move forward.'],['ğŸªœ','Land on a ladder bottom â€” climb up!'],['ğŸ','Land on a snake head â€” slide down!'],['ğŸ’','Bonus boxes appear on some ladder cells.'],['ğŸ†','Land exactly on 100 to win!'],['â›”','Overshoot 100? You stay in place.'],['ğŸ¤–','In AI mode the computer plays automatically!']].map(([ic,tx],i)=>
        <div key={i} style={{display:'flex',gap:9,marginBottom:8,alignItems:'flex-start'}}>
          <span style={{fontSize:16,flexShrink:0}}>{ic}</span>
          <span style={{color:night?'#e5d5b5':'#2d1b4e',fontSize:12,lineHeight:1.5}}>{tx}</span>
        </div>
      )}
      <div style={{height:1,background:night?'rgba(255,215,0,.15)':'rgba(123,45,139,.15)',margin:'14px 0'}}/>
      <div style={{fontFamily:'Cinzel,serif',color:a,fontSize:10,letterSpacing:2,fontWeight:700,marginBottom:10}}>ğŸ’ BONUS POWERS</div>
      <p style={{fontSize:11,color:sub,marginBottom:10,lineHeight:1.6}}>Land on a bonus ladder cell to collect a power-up!</p>
      {BONUS_TYPES.map(b=><div key={b.id} style={{display:'flex',gap:10,marginBottom:10,padding:'9px 11px',background:`${b.color}14`,borderRadius:11,border:`1px solid ${b.color}33`,alignItems:'flex-start'}}>
        <span style={{fontSize:20,flexShrink:0}}>{b.icon}</span>
        <div><div style={{fontWeight:800,color:b.color,fontSize:12,marginBottom:1}}>{b.label}</div><div style={{fontSize:11,color:sub,lineHeight:1.5}}>{b.desc}</div></div>
      </div>)}
      <button onClick={onClose} style={{width:'100%',border:'none',borderRadius:50,padding:'12px',background:`linear-gradient(135deg,${night?'#b45309':'#7b2d8b'},${night?'#fbbf24':'#c77dff'})`,color:'white',fontSize:14,fontWeight:800,cursor:'pointer',fontFamily:'Nunito,sans-serif',letterSpacing:1}}>âœ“ Got It!</button>
    </div>
  </div>;
}

/* â•â•â• BONUS TOAST â•â•â• */
function BonusToast({bonus,name}){
  if(!bonus)return null;
  return <div style={{position:'fixed',top:62,left:'50%',transform:'translateX(-50%)',background:`linear-gradient(135deg,${bonus.color},${bonus.color}bb)`,color:'white',padding:'8px 20px',borderRadius:50,fontWeight:800,fontSize:12,zIndex:700,boxShadow:`0 8px 30px ${bonus.color}55`,animation:'bonusToast 2.5s ease forwards',whiteSpace:'nowrap'}}>{bonus.icon} {name} got: {bonus.label}!</div>;
}

/* â•â•â• iOS TOGGLE â•â•â• */
function IosToggle({night,onToggle}){
  return <div className="ios-wrap">
    <button className={`ios-seg${!night?' active':''}`} onClick={()=>night&&onToggle()}>â˜€ï¸ <span className="ios-label">Day</span></button>
    <button className={`ios-seg${night?' active':''}`}  onClick={()=>!night&&onToggle()}>ğŸŒ™ <span className="ios-label">Night</span></button>
  </div>;
}

/* â•â•â• STAGE 1: MODE SELECT â•â•â• */
function ModeSelect({night,onSelect}){
  const a=night?'#ffd700':'#7b2d8b',sub=night?'rgba(255,220,150,.6)':'#6b5a8e';
  return <div style={{maxWidth:500,margin:'0 auto',padding:'0 14px',animation:'slideUp .45s ease'}}>
    <div style={{textAlign:'center',marginBottom:26}}>
      <div style={{fontSize:46,marginBottom:10}}>ğŸ²</div>
      <h2 style={{fontFamily:'Cinzel,serif',color:a,fontSize:20,fontWeight:900,marginBottom:5}}>Choose Game Mode</h2>
      <p style={{color:sub,fontSize:13}}>How would you like to play?</p>
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14}}>
      {[{id:'hvh',icon:'ğŸ¤',title:'2 Players',sub:'Shubham vs Shivani',desc:'Both players take turns on the same device.',gF:'#7b2d8b',gT:'#c77dff'},
        {id:'ai', icon:'ğŸ¤–',title:'vs AI',    sub:'Play vs Computer', desc:'You pick your character â€” AI rolls automatically.',gF:'#0077b6',gT:'#48cae4'}].map(m=>(
        <div key={m.id} className="mode-card glass" onClick={()=>onSelect(m.id)} style={{background:`linear-gradient(135deg,${m.gF}22,${m.gT}18)`,borderColor:`${m.gF}66`}}>
          <div style={{fontSize:42,marginBottom:10}}>{m.icon}</div>
          <div style={{fontFamily:'Cinzel,serif',color:m.gF,fontSize:16,fontWeight:900,marginBottom:3}}>{m.title}</div>
          <div style={{color:a,fontSize:11,fontWeight:700,marginBottom:8}}>{m.sub}</div>
          <div style={{color:sub,fontSize:11,lineHeight:1.5,marginBottom:14}}>{m.desc}</div>
          <div style={{display:'inline-block',padding:'7px 18px',borderRadius:50,background:`linear-gradient(135deg,${m.gF},${m.gT})`,color:'white',fontSize:12,fontWeight:800,letterSpacing:1}}>SELECT</div>
        </div>
      ))}
    </div>
  </div>;
}

/* â•â•â• STAGE 2: CHARACTER SELECT (AI only) â•â•â• */
function CharSelect({night,onConfirm}){
  const [chosen,setChosen]=useState(null);
  const a=night?'#ffd700':'#7b2d8b',sub=night?'rgba(255,220,150,.6)':'#6b5a8e';
  return <div style={{maxWidth:500,margin:'0 auto',padding:'0 14px',animation:'slideUp .45s ease'}}>
    <div style={{textAlign:'center',marginBottom:22}}>
      <div style={{fontSize:34,marginBottom:8}}>ğŸ¤– vs You</div>
      <h2 style={{fontFamily:'Cinzel,serif',color:a,fontSize:18,fontWeight:900,marginBottom:5}}>Who Are You Playing As?</h2>
      <p style={{color:sub,fontSize:12,lineHeight:1.6}}>Shivani away? Shubham can play solo vs AI!<br/>Pick your character â€” the AI controls the other.</p>
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14,marginBottom:22}}>
      {[{id:'S',name:'Shubham',isSh:true,tagline:'Bold moves, big wins!'},{id:'V',name:'Shivani',isSh:false,tagline:'Cunning strategy wins!'}].map(ch=>{
        const sel=chosen===ch.id,col=ch.isSh?COLORS[0]:COLORS[1];
        return <div key={ch.id} className="mode-card glass" onClick={()=>setChosen(ch.id)} style={{borderColor:sel?col.v:'transparent',boxShadow:sel?`0 0 22px ${col.v}55`:'none',background:sel?`linear-gradient(135deg,${col.v}22,${col.l}18)`:'',transition:'all .25s'}}>
          <div style={{display:'flex',justifyContent:'center',marginBottom:10}}>
            <Avatar isSh={ch.isSh} color={sel?col.v:(night?'#555':'#aaa')} size={68} uid={`char_${ch.id}_${_uid++}`}/>
          </div>
          <div style={{fontFamily:'Cinzel,serif',color:sel?col.v:(night?'#aaa':'#888'),fontSize:15,fontWeight:900,marginBottom:4}}>{ch.name}</div>
          <div style={{color:sub,fontSize:11,marginBottom:sel?8:0}}>{ch.tagline}</div>
          {sel&&<div style={{fontSize:18}}>âœ…</div>}
        </div>;
      })}
    </div>
    {chosen&&<div style={{textAlign:'center'}}>
      <button onClick={()=>onConfirm(chosen)} className="shimmer-btn" style={{border:'none',borderRadius:50,padding:'14px 44px',color:'white',fontSize:17,fontWeight:900,cursor:'pointer',letterSpacing:3,fontFamily:'Cinzel,serif',fontStyle:'italic',boxShadow:'0 10px 35px rgba(123,45,139,.5)'}}>ğŸ® Let's Play!</button>
    </div>}
  </div>;
}

/* â•â•â• STAGE 3: COLOR SETUP â•â•â• */
function SetupPhase({cS,cV,setCols,onStart,night,mode,humanPlayer}){
  const sub=night?'rgba(255,220,150,.6)':'#6b5a8e';
  const players=mode==='hvh'
    ?[{key:'S',name:'Shubham',isSh:true,color:cS},{key:'V',name:'Shivani',isSh:false,color:cV}]
    :humanPlayer==='S'
      ?[{key:'S',name:'Shubham',isSh:true,color:cS},{key:'V',name:'Shivani (AI) ğŸ¤–',isSh:false,color:cV,isAI:true}]
      :[{key:'S',name:'Shubham (AI) ğŸ¤–',isSh:true,color:cS,isAI:true},{key:'V',name:'Shivani',isSh:false,color:cV}];
  return <div style={{maxWidth:620,margin:'0 auto',padding:'0 14px',animation:'slideUp .5s ease'}}>
    <div style={{textAlign:'center',marginBottom:18}}>
      <p style={{color:sub,fontSize:12,letterSpacing:2}}>{mode==='hvh'?'ğŸ‘¥ 2 PLAYER MODE':'ğŸ¤– VS AI â€” PICK YOUR COLORS'}</p>
    </div>
    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14,marginBottom:20}}>
      {players.map(({key,name,isSh,color,isAI})=>(
        <div key={key} className="glass" style={{borderRadius:20,padding:18,textAlign:'center',borderColor:`${color.v}55`,boxShadow:`0 8px 28px ${color.v}33`,position:'relative'}}>
          {isAI&&<div style={{position:'absolute',top:8,right:8,background:'#0077b6',color:'white',fontSize:9,fontWeight:800,padding:'2px 7px',borderRadius:18,letterSpacing:1}}>ğŸ¤– AI</div>}
          <div style={{display:'flex',justifyContent:'center',marginBottom:10}}>
            <Avatar isSh={isSh} color={color.v} size={72} uid={`setup_${key}_${_uid++}`}/>
          </div>
          <h2 style={{fontFamily:'Cinzel,serif',color:color.v,fontSize:15,fontWeight:900,marginBottom:3}}>{name}</h2>
          <p style={{color:sub,fontSize:10,letterSpacing:3,marginBottom:10}}>COLOR</p>
          <div style={{display:'flex',flexWrap:'wrap',gap:6,justifyContent:'center',marginBottom:9}}>
            {COLORS.map((c,i)=><button key={i} onClick={()=>setCols(key,COLORS[i])} style={{width:24,height:24,borderRadius:'50%',cursor:'pointer',background:`linear-gradient(135deg,${c.v},${c.l})`,border:`3px solid ${color===c?'white':'transparent'}`,transform:color===c?'scale(1.38)':'scale(1)',boxShadow:color===c?`0 0 10px ${c.v}`:' none',transition:'all .2s'}}/>)}
          </div>
          <span style={{display:'inline-block',padding:'3px 12px',borderRadius:18,background:`linear-gradient(135deg,${color.v},${color.l})`,color:'white',fontSize:10,fontWeight:800,letterSpacing:1}}>{color.name}</span>
        </div>
      ))}
    </div>
    <div style={{textAlign:'center'}}>
      <button onClick={onStart} className="shimmer-btn" style={{border:'none',borderRadius:50,padding:'14px 46px',color:'white',fontSize:17,fontWeight:900,cursor:'pointer',letterSpacing:3,fontFamily:'Cinzel,serif',fontStyle:'italic',boxShadow:'0 10px 35px rgba(123,45,139,.5)'}}>ğŸ® Start Game</button>
    </div>
  </div>;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function App(){
  const [night,setNight]=useState(true);
  const [stage,setStage]=useState('mode');
  const [gameMode,setGameMode]=useState('hvh');
  const [humanPlayer,setHumanPlayer]=useState('S');
  const [cS,setCS]=useState(COLORS[0]);
  const [cV,setCV]=useState(COLORS[1]);
  const [G,setG]=useState(null);
  const [rolling,setRolling]=useState(false);
  const [aiThinking,setAiThinking]=useState(false);// UI only
  const [dice,setDice]=useState(null);
  const [movingP,setMovingP]=useState(null);
  const [showInfo,setShowInfo]=useState(false);
  const [confetti,setConfetti]=useState(false);
  const [toast,setToast]=useState(null);
  const [cellSize,setCellSize]=useState(50);
  const [isFullscreen,setIsFullscreen]=useState(false);

  // Refs â€” always hold latest values, no stale closure issues
  const Gref=useRef(G);        Gref.current=G;
  const gameModeRef=useRef(gameMode); gameModeRef.current=gameMode;
  const humanPlayerRef=useRef(humanPlayer); humanPlayerRef.current=humanPlayer;
  const rollingRef=useRef(false);
  // Guard: prevents double-scheduling AI turn
  const aiScheduledRef=useRef(false);

  useEffect(()=>{document.body.className=night?'night':'day';},[night]);
  useEffect(()=>{
    function calc(){setCellSize(Math.max(32,Math.floor(Math.min(500,window.innerWidth-28)/10)));}
    calc();window.addEventListener('resize',calc);return()=>window.removeEventListener('resize',calc);
  },[]);
  useEffect(()=>{
    function fs(){setIsFullscreen(!!document.fullscreenElement);}
    document.addEventListener('fullscreenchange',fs);return()=>document.removeEventListener('fullscreenchange',fs);
  },[]);

  function toggleFullscreen(){
    if(!document.fullscreenElement)document.documentElement.requestFullscreen?.();
    else document.exitFullscreen?.();
  }
  function setCols(player,color){if(player==='S')setCS(color);else setCV(color);}
  function pname(p){return p==='S'?'Shubham':'Shivani';}
  function isAI(p){return gameModeRef.current==='ai'&&p!==humanPlayerRef.current;}

  function assignBonuses(){
    const map={};
    Object.keys(LADDERS).forEach(cell=>{if(Math.random()<.65)map[+cell]=BONUS_TYPES[Math.floor(Math.random()*4)];});
    return map;
  }

  function startGame(){
    aiScheduledRef.current=false;
    rollingRef.current=false;
    setG({pos:{S:0,V:0},cur:'S',powers:{S:[],V:[]},frozen:{S:0,V:0},bonusMap:assignBonuses(),log:[],winner:null});
    setDice(null);setRolling(false);setAiThinking(false);setConfetti(false);setMovingP(null);setToast(null);
    setStage('playing');
  }

  function showToast(bonus,p){setToast({bonus,name:pname(p)});setTimeout(()=>setToast(null),2700);}

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AI AUTO-MOVE â€” the key fix:
     Â· Depends ONLY on G?.cur, stage, G?.winner
     Â· Uses aiScheduledRef to prevent double-firing
     Â· Uses refs (not closures) to check isAI & rolling
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  useEffect(()=>{
    if(stage!=='playing')return;
    const g=Gref.current;
    if(!g||g.winner)return;
    if(!isAI(g.cur))return;          // human's turn â€” do nothing
    if(aiScheduledRef.current)return; // already scheduled

    aiScheduledRef.current=true;
    setAiThinking(true);

    const delay=900+Math.random()*700;
    const t=setTimeout(()=>{
      aiScheduledRef.current=false;
      setAiThinking(false);
      execRoll(); // AI rolls
    },delay);

    return()=>{
      clearTimeout(t);
      aiScheduledRef.current=false;
    };
  // eslint-disable-next-line react-hooks/exhaustive-deps
  },[G?.cur, stage, G?.winner]);

  /* Shared dice-spin + move logic */
  function execRoll(){
    if(rollingRef.current)return;
    rollingRef.current=true;
    setRolling(true);
    let n=0;
    const iv=setInterval(()=>{
      setDice(Math.ceil(Math.random()*6));
      if(++n>=14){
        clearInterval(iv);
        const v=Math.ceil(Math.random()*6);
        setDice(v);
        rollingRef.current=false;
        setRolling(false);
        doMove(v);
      }
    },65);
  }

  function rollDice(){
    const g=Gref.current;
    if(!g||g.winner||rollingRef.current||aiThinking)return;
    if(isAI(g.cur))return; // human cannot roll on AI's turn
    execRoll();
  }

  function doMove(val){
    const g=Gref.current;
    if(!g||g.winner)return;
    const p=g.cur,opp=p==='S'?'V':'S';
    const log=[];

    // Frozen check
    if(g.frozen[p]>0){
      log.push(`â„ï¸ ${pname(p)} is frozen! Turn skipped.`);
      setG(prev=>({...prev,frozen:{...prev.frozen,[p]:prev.frozen[p]-1},cur:opp,log:[...log,...prev.log].slice(0,10)}));
      return;
    }

    let np=g.pos[p]+val;
    const aiTag=isAI(p)?' ğŸ¤–':'';
    log.push(`ğŸ² ${pname(p)}${aiTag} rolled ${val} â†’ ${np}`);

    if(np>100){log.push(`â›” Needs ${100-g.pos[p]}. Stay!`);setG(prev=>({...prev,cur:opp,log:[...log,...prev.log].slice(0,10)}));return;}

    setMovingP(p);setTimeout(()=>setMovingP(null),750);

    let extraRoll=false;
    const nPow={S:[...g.powers.S],V:[...g.powers.V]};
    const nFrz={...g.frozen};
    let nBon={...g.bonusMap};

    // Bonus (on ladder cell)
    if(nBon[np]&&LADDERS[np]){
      const b=nBon[np];log.push(`ğŸ’ ${pname(p)} got: ${b.icon} ${b.label}!`);
      const nb={...nBon};delete nb[np];nBon=nb;showToast(b,p);
      if(b.id==='extra'){extraRoll=true;log.push(`â­ ${pname(p)} rolls again!`);}
      else if(b.id==='shield'){nPow[p]=[...nPow[p],b];log.push(`ğŸ›¡ï¸ Shield stored!`);}
      else if(b.id==='jump'){np=Math.min(100,np+5);log.push(`ğŸš€ Jumped to ${np}!`);}
      else if(b.id==='freeze'){nFrz[opp]=(nFrz[opp]||0)+1;log.push(`â„ï¸ ${pname(opp)} frozen 1 turn!`);}
    }

    // Ladder
    if(LADDERS[np]){const d=LADDERS[np];log.push(`ğŸªœ Ladder! ${np}â†’${d}`);np=d;}
    // Snake
    else if(SNAKES[np]){
      const si=nPow[p].findIndex(b=>b.id==='shield');
      if(si>=0){nPow[p].splice(si,1);log.push(`ğŸ›¡ï¸ Shield blocked snake at ${np}!`);}
      else{const d=SNAKES[np];log.push(`ğŸ Snake! ${np}â†’${d}`);np=d;}
    }

    // Win
    if(np===100){
      log.push(`ğŸ† ${pname(p)} WINS!`);
      setG(prev=>({...prev,pos:{...prev.pos,[p]:100},powers:nPow,frozen:nFrz,bonusMap:nBon,cur:p,winner:p,log:[...log,...prev.log].slice(0,12)}));
      setTimeout(()=>setConfetti(true),300);
      return;
    }

    const nextCur=extraRoll?p:opp;
    setG(prev=>({...prev,pos:{...prev.pos,[p]:np},powers:nPow,frozen:nFrz,bonusMap:nBon,cur:nextCur,log:[...log,...prev.log].slice(0,10)}));
  }

  /* â”€â”€â”€ computed values â”€â”€â”€ */
  const accent=night?'#ffd700':'#7b2d8b';
  const sub=night?'rgba(255,220,150,.6)':'#6b5a8e';
  const curColor=G?.cur==='S'?cS:cV;
  const isAIcur=G?isAI(G.cur):false;

  function goBack(){
    aiScheduledRef.current=false;
    if(stage==='charSelect')setStage('mode');
    else if(stage==='setup')setStage(gameMode==='ai'?'charSelect':'mode');
    else if(stage==='playing'){setStage('mode');setG(null);setConfetti(false);}
  }

  /* â”€â”€â”€ Header button style helper â”€â”€â”€ */
  const hbStyle={
    background:night?'rgba(255,255,255,.07)':'rgba(0,0,0,.07)',
    border:`1.5px solid ${night?'rgba(255,215,0,.22)':'rgba(123,45,139,.22)'}`,
    color:accent,
  };

  return(
    <div style={{minHeight:'100vh',transition:'all .5s'}}>
      {confetti&&<Confetti/>}
      {toast&&<BonusToast bonus={toast.bonus} name={toast.name}/>}

      {/* â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•
          Left  | Title (flex:1, shrinks) | Right
          Labels hidden on narrow screens via CSS  */}
      <div className="site-header glass" style={{borderBottom:`1px solid ${night?'rgba(255,215,0,.1)':'rgba(123,45,139,.1)'}`,borderRadius:0}}>

        {/* Left zone */}
        <div className="hdr-left">
          {stage!=='mode'&&(
            <button className="hdr-btn" onClick={goBack} style={hbStyle}>â€¹ Back</button>
          )}
          <button className="hdr-btn" onClick={()=>setShowInfo(true)} style={hbStyle}>ğŸ“œ</button>
        </div>

        {/* Centre â€” title shrinks/ellipsis naturally */}
        <div className="hdr-title">
          <h1 style={{color:accent,textShadow:night?'0 0 20px rgba(255,215,0,.4)':'2px 2px 0 rgba(123,45,139,.12)'}}>
            ğŸ Saanp Seedhi ğŸªœ
          </h1>
          <div className="sub" style={{color:sub}}>SHUBHAM vs SHIVANI</div>
        </div>

        {/* Right zone â€” toggle + fullscreen together */}
        <div className="hdr-right">
          <IosToggle night={night} onToggle={()=>setNight(n=>!n)}/>
          <button onClick={toggleFullscreen} className="fs-btn" title={isFullscreen?'Exit':'Fullscreen'}
            style={{color:accent,background:night?'rgba(255,215,0,.1)':'rgba(123,45,139,.1)',border:`1.5px solid ${night?'rgba(255,215,0,.25)':'rgba(123,45,139,.2)'}`}}>
            {isFullscreen?'âŠ¡':'â›¶'}
          </button>
        </div>
      </div>

      {/* â•â• CONTENT â•â• */}
      <div style={{padding:'18px 12px'}}>

        {stage==='mode'&&<ModeSelect night={night} onSelect={mode=>{setGameMode(mode);setStage(mode==='ai'?'charSelect':'setup');}}/>}

        {stage==='charSelect'&&<CharSelect night={night} onConfirm={player=>{setHumanPlayer(player);humanPlayerRef.current=player;setStage('setup');}}/>}

        {stage==='setup'&&<SetupPhase cS={cS} cV={cV} setCols={setCols} onStart={startGame} night={night} mode={gameMode} humanPlayer={humanPlayer}/>}

        {stage==='playing'&&G&&(
          <div style={{maxWidth:840,margin:'0 auto'}}>

            {/* Board */}
            <div style={{display:'flex',justifyContent:'center',marginBottom:11}}>
              <div style={{position:'relative',display:'inline-block',borderRadius:14,overflow:'visible',boxShadow:night?'0 0 50px rgba(255,215,0,.1),0 20px 60px rgba(0,0,0,.6)':'0 16px 50px rgba(123,45,139,.22)'}}>
                <BoardGrid bonusMap={G.bonusMap} night={night} C={cellSize}/>
                <BoardSVGOverlay C={cellSize}/>
                {G.pos.S>0&&<Token player="S" position={G.pos.S} color={cS.v} sameCell={G.pos.S===G.pos.V} moving={movingP==='S'} C={cellSize}/>}
                {G.pos.V>0&&<Token player="V" position={G.pos.V} color={cV.v} sameCell={G.pos.S===G.pos.V} moving={movingP==='V'} C={cellSize}/>}
              </div>
            </div>

            {/* Legend */}
            <div style={{display:'flex',gap:10,justifyContent:'center',flexWrap:'wrap',fontSize:11,color:sub,marginBottom:12}}>
              <span>ğŸ Slide down</span><span>ğŸªœ Climb up</span><span>ğŸ’ Bonus</span><span>ğŸ† Win at 100</span>
            </div>

            {/* Player cards ROW */}
            <div className="player-row" style={{marginBottom:10}}>
              {[['S',cS,true],['V',cV,false]].map(([p,col,isSh])=>{
                const isActive=G.cur===p&&!G.winner;
                const isFrz=G.frozen[p]>0;
                const playerIsAI=isAI(p);
                return <div key={p} className="glass" style={{borderRadius:14,padding:'11px 12px',borderColor:isFrz?'#38bdf8':isActive?col.v:'transparent',boxShadow:isFrz?'0 0 18px rgba(56,189,248,.3)':isActive?`0 0 18px ${col.v}55`:'none',animation:isFrz?'freezeGlow 1.5s infinite':isActive?'pulseGlow 2s infinite':'none',transition:'all .3s'}}>
                  <div style={{display:'flex',alignItems:'center',gap:9}}>
                    <div style={{position:'relative',flexShrink:0}}>
                      <Avatar isSh={isSh} color={col.v} size={42} uid={`pnl${p}${_uid++}`}/>
                      {playerIsAI&&<span style={{position:'absolute',bottom:-2,right:-2,background:'#0077b6',color:'white',fontSize:7,fontWeight:900,padding:'1px 3px',borderRadius:6}}>AI</span>}
                    </div>
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontFamily:'Cinzel,serif',color:col.v,fontSize:'clamp(11px,2.5vw,15px)',fontWeight:900,display:'flex',alignItems:'center',gap:4,flexWrap:'wrap'}}>
                        {isSh?'Shubham':'Shivani'}
                        {isActive&&!G.winner&&!aiThinking&&!playerIsAI&&<span style={{fontSize:12,animation:'floatAnim 1s infinite'}}>ğŸ‘†</span>}
                        {isActive&&aiThinking&&playerIsAI&&<span style={{fontSize:10,color:'#48cae4'}}>
                          <span className="ai-dot" style={{'--dd':'0s'}}>â€¢</span>
                          <span className="ai-dot" style={{'--dd':'.2s'}}>â€¢</span>
                          <span className="ai-dot" style={{'--dd':'.4s'}}>â€¢</span>
                        </span>}
                        {isFrz&&<span style={{fontSize:10,color:'#38bdf8'}}>â„ï¸</span>}
                      </div>
                      <div style={{color:sub,fontSize:10,margin:'1px 0 4px'}}>Cell <strong style={{color:night?'#f5e6c8':'#2d1b4e'}}>{G.pos[p]}</strong>/100</div>
                      <div style={{height:5,background:night?'rgba(255,255,255,.1)':'rgba(0,0,0,.1)',borderRadius:3,overflow:'hidden',marginBottom:3}}>
                        <div style={{height:'100%',width:`${G.pos[p]}%`,background:`linear-gradient(90deg,${col.v},${col.l})`,borderRadius:3,transition:'width .6s ease'}}/>
                      </div>
                      {G.powers[p].length>0&&<div style={{display:'flex',flexWrap:'wrap',gap:2}}>
                        {G.powers[p].map((b,i)=><span key={i} style={{fontSize:8,padding:'1px 4px',borderRadius:5,background:`${b.color}22`,color:b.color,border:`1px solid ${b.color}44`,fontWeight:700}}>{b.icon} {b.label}</span>)}
                      </div>}
                    </div>
                  </div>
                </div>;
              })}
            </div>

            {/* Dice + Roll button */}
            <div className="glass" style={{borderRadius:14,padding:'14px 16px',textAlign:'center',marginBottom:10}}>
              {/* AI thinking banner */}
              {aiThinking&&(
                <div style={{color:'#48cae4',fontSize:12,fontWeight:700,marginBottom:8,letterSpacing:1}}>
                  ğŸ¤– AI is thinking<span className="ai-dot" style={{'--dd':'0s'}}>.</span><span className="ai-dot" style={{'--dd':'.25s'}}>.</span><span className="ai-dot" style={{'--dd':'.5s'}}>.</span>
                </div>
              )}
              <div className={rolling?'dice-spin':''} style={{fontSize:'clamp(52px,11vw,70px)',lineHeight:1,marginBottom:10,display:'inline-block',filter:night?'drop-shadow(0 0 14px rgba(255,215,0,.5))':'drop-shadow(0 3px 8px rgba(0,0,0,.2))',cursor:G.winner||aiThinking?'default':'pointer'}} onClick={!rolling&&!G.winner&&!aiThinking?rollDice:undefined}>
                {dice?DICE_EMOJI[dice]:'ğŸ²'}
              </div>
              {!G.winner&&(
                <button onClick={rollDice} disabled={rolling||aiThinking||isAIcur}
                  style={{display:'block',width:'100%',border:'none',borderRadius:50,padding:'12px 0',color:'white',fontSize:14,fontWeight:800,letterSpacing:2,cursor:(rolling||aiThinking||isAIcur)?'not-allowed':'pointer',fontFamily:'Nunito,sans-serif',background:(rolling||aiThinking||isAIcur)?'#444':`linear-gradient(135deg,${curColor.v},${curColor.l})`,boxShadow:(rolling||aiThinking||isAIcur)?'none':`0 6px 22px ${curColor.v}66`,opacity:(rolling||aiThinking)?0.7:1,transition:'all .2s'}}>
                  {rolling?'Rollingâ€¦'
                    :aiThinking?`ğŸ¤– ${pname(G.cur)} is rollingâ€¦`
                    :G.frozen[G.cur]>0?`â„ï¸ ${pname(G.cur)} â€” Frozen!`
                    :isAIcur?`ğŸ¤– AI is playing as ${pname(G.cur)}â€¦`
                    :`${pname(G.cur)}'s Roll`}
                </button>
              )}
            </div>

            {/* Move Log */}
            {G.log.length>0&&<div className="glass" style={{borderRadius:13,padding:'10px 13px',maxHeight:118,overflowY:'auto',marginBottom:10}}>
              <div style={{fontFamily:'Cinzel,serif',color:accent,fontSize:10,letterSpacing:2,marginBottom:6,fontWeight:700}}>ğŸ“‹ MOVE LOG</div>
              {G.log.map((m,i)=><div key={i} style={{fontSize:11,lineHeight:1.6,marginBottom:3,color:i===0?(night?'#f5e6c8':'#2d1b4e'):(night?'rgba(245,230,200,.4)':'rgba(45,27,78,.4)'),borderLeft:`2px solid ${i===0?accent:'transparent'}`,paddingLeft:6}}>{m}</div>)}
            </div>}

            {/* Win Card */}
            {G.winner&&<div className="win-pop glass" style={{borderRadius:22,padding:22,textAlign:'center',borderColor:G.winner==='S'?cS.v:cV.v,boxShadow:`0 10px 40px ${G.winner==='S'?cS.v:cV.v}44`,marginBottom:10}}>
              <div style={{fontSize:44,marginBottom:6}}>ğŸ†</div>
              <div style={{display:'flex',justifyContent:'center',marginBottom:10}}>
                <Avatar isSh={G.winner==='S'} color={G.winner==='S'?cS.v:cV.v} size={62} uid={`win${_uid++}`}/>
              </div>
              <div style={{fontFamily:'Cinzel,serif',fontSize:20,fontWeight:900,color:G.winner==='S'?cS.v:cV.v}}>{pname(G.winner)}{isAI(G.winner)?' ğŸ¤–':''}</div>
              <div style={{color:sub,fontSize:12,margin:'4px 0 16px',letterSpacing:2}}>WINS THE GAME! ğŸ‰</div>
              <div style={{display:'flex',gap:9,justifyContent:'center',flexWrap:'wrap'}}>
                <button onClick={()=>{setStage('mode');setG(null);setConfetti(false);aiScheduledRef.current=false;}} style={{border:'none',borderRadius:50,padding:'10px 20px',background:`linear-gradient(135deg,${G.winner==='S'?cS.v:cV.v},${G.winner==='S'?cS.l:cV.l})`,color:'white',fontSize:13,fontWeight:800,cursor:'pointer',letterSpacing:1,fontFamily:'Nunito,sans-serif'}}>ğŸ”„ New Game</button>
                <button onClick={()=>{aiScheduledRef.current=false;startGame();}} style={{border:`2px solid ${G.winner==='S'?cS.v:cV.v}`,borderRadius:50,padding:'10px 20px',background:'transparent',color:G.winner==='S'?cS.v:cV.v,fontSize:13,fontWeight:800,cursor:'pointer',letterSpacing:1,fontFamily:'Nunito,sans-serif'}}>â†º Rematch</button>
              </div>
            </div>}

          </div>
        )}
      </div>
      {showInfo&&<InfoModal onClose={()=>setShowInfo(false)} night={night}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
